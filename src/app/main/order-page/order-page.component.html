<ion-header class="ion-no-border">
  <ion-toolbar mode="ios" class="bg-default">
    <ion-button slot="start" (click)="onback()" fill="clear">
      <ion-icon style="color: white !important;" class="text-dark" name="chevron-back-outline"></ion-icon>
    </ion-button>
    <ion-title style="color: white !important;" class="dynamic-font text-dark">Danh sách đơn hàng</ion-title>
  </ion-toolbar>
  <ion-toolbar class="p-2" class="bg-default">
    <div class="w-100 d-flex align-items-center">
      <ion-searchbar class="pb-0 pl-0 pl-2 pr-2" style="--border-radius:20px !important" id='custom-search' placeholder="Tìm kiếm đơn hàng" (ionChange)="ionChange($event)"
      enterkeyhint="search" mode="ios" show-clear-button="always"></ion-searchbar>
      <ion-icon (click)="openPopFilter()" class="pr-2" style="color: white !important;font-size: 2rem;" name="funnel-outline"></ion-icon>  
    </div>
  </ion-toolbar>
  <ion-toolbar style="--background:white !important;">
    <ion-segment  mode="md" [scrollable]="true" [value]="status">
      <ion-segment-button  (click)=" sortData(0)" [value]="0">
        <ion-text class="text-segment dynamic-font font-weight-bold">
          <span>Tất cả</span>
        </ion-text>
      </ion-segment-button>
      <ion-segment-button  (click)=" sortData(1)" [value]="1">
        <ion-text class="text-segment dynamic-font font-weight-bold">
          <span>Chờ thanh toán</span>
        </ion-text>
      </ion-segment-button>
      <ion-segment-button  (click)=" sortData(2)" [value]="2">
        <ion-text class="text-segment dynamic-font font-weight-bold">
          <span>Đã thanh toán</span>
        </ion-text>
      </ion-segment-button>
      <ion-segment-button  (click)=" sortData(3)" [value]="3">
        <ion-text class="text-segment dynamic-font font-weight-bold">
          <span>Đã hủy</span>
        </ion-text>
      </ion-segment-button>
      <ion-segment-button  (click)=" sortData(4)" [value]="4">
        <ion-text class="text-segment dynamic-font font-weight-bold">
          <span>Khác</span>
        </ion-text>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>
<ion-content style="--background:white !important;">
  <ng-container *ngIf="isEmpty">
    <div style="flex-direction: column;" class="d-flex align-items-center justify-content-center h-100">
      <img style="width: 40%;" src="../../../assets/image/empty-box.png" alt="">
      <ion-text class="dynamic-font" style="color:black !important">
        Không có đơn hàng
      </ion-text>
    </div>
  </ng-container>
  <div class="w-100 mt-2">
    <ion-list *ngIf="lstData && lstData.length" class="m-0" style="background-color:white !important;">
      <div *ngIf="status == 1" class="w-100 p-2 pt-0">
        <ion-text class="dynamic-font" color="medium">
          <span>Tổng đơn: </span>
        </ion-text>
        <ion-text class="dynamic-font text-dark font-weight-bold">
          {{totalOrder}}
        </ion-text>
        <ion-text class="dynamic-font text-dark">
          |
        </ion-text>
        <ion-text class="dynamic-font" color="medium">
          <span>Tổng tiền chưa thanh toán: </span>
        </ion-text>
        <ion-text class="dynamic-font text-dark font-weight-bold">
          {{(totalPay | number)+'đ'}}
        </ion-text>
      </div>
      <ng-container *ngFor="let item of lstData">
        <ion-item lines="none" style="--background:white !important">
          <ion-card class="mx-1 my-1 mb-4 w-100"
            style="--background:white !important;box-shadow: rgba(0, 0, 0, 0.05) 0px 6px 24px 0px, rgba(0, 0, 0, 0.08) 0px 0px 0px 1px !important;">
            <ion-card-header class="p-3">
              <div style="justify-content: space-between;" class="d-flex align-items-center">
                <div class="d-flex align-items-center">
                  <ion-text style="font-size: 1rem;" class="dynamic-font text-dark font-weight-bold pr-2">
                    Mã đơn hàng
                  </ion-text>
                </div>
                <div class="d-flex align-items-center">
                  <ion-text class="dynamic-font pr-2" style="font-size: 1rem;">
                    {{item.shippingOrderCode}}
                  </ion-text>
                  <ion-icon [cdkCopyToClipboard]="item.shippingOrderCode" (click)="onCopy()" style="font-size: 2rem;"
                    name="copy-outline"></ion-icon>
                </div>
              </div>
            </ion-card-header>
            <ion-card-content class="p-3">
              <div class="w-100" (click)="viewDetail(item)" >
                <div class="d-flex align-items-center">
                  <ng-container *ngIf="item.status == 1">
                    <img  style="width: 4em;height: 4em;
                    margin-right: 1rem;" src="../../../assets/image/wait-order.png" alt="">
                  </ng-container>
                  <ng-container *ngIf="item.status == 2">
                    <img  style="width: 4em;height: 4em;
                    margin-right: 1rem;" src="../../../assets/image/done-order.png" alt="">
                  </ng-container>
                  <ng-container *ngIf="item.status == 3">
                    <img  style="width: 4em;height: 4em;
                    margin-right: 1rem;" src="../../../assets/image/ship-cancel.png" alt="">
                  </ng-container>
                  <ng-container *ngIf="item.status == 4">
                    <img  style="width: 4em;height: 4em;
                    margin-right: 1rem;" src="../../../assets/image/ship-other.png" alt="">
                  </ng-container>
                  <div>
                    <ion-text mode="ios" class="dynamic-font">
                      <span class="font-weight-bold text-dark"> Vận chuyển: </span>
                      <span>{{item.shippingMethodName}}</span>
                    </ion-text>
                    <br>
                    <ion-text class="dynamic-font">
                      <span class="font-weight-bold text-dark">Ngày tạo: </span>
                      <span>{{item.createdDate | date : 'dd/MM/yyyy hh:mm a'}}</span>
                    </ion-text>
                    <br>
                    <ion-text class="dynamic-font">
                      <span class="font-weight-bold text-dark">Người tạo: </span>
                      <span>{{item.lastName}}</span>
                    </ion-text>
                    <br>
                    <ion-text class="dynamic-font">
                      <span class="font-weight-bold text-dark">Dịch vụ phụ: </span>
                      <span *ngIf="item.isWoodPackage">Đóng gỗ</span>
                      <span *ngIf="item.isWoodPackage && item.isAirPackage">-</span>
                      <span *ngIf="item.isAirPackage">Bọt khí</span>
                      <span *ngIf="item.isAirPackage && item.isInsurance">-</span>
                      <span *ngIf="item.isInsurance">Bảo hiểm</span>
                      <span *ngIf="!item.isWoodPackage && !item.isAirPackage && !item.isInsurance">Không có</span>
                    </ion-text>
                    <ion-text>
                    </ion-text>
                  </div>
                </div>
                <div class="d-flex justify-content-end mb-2">
                  <ng-container [ngSwitch]="item.status">
                    <ion-badge  mode="ios" *ngSwitchCase="1" color="warning">
                      <ion-text style="font-size: 1rem;color: white !important;" class="dynamic-font">
                        <span>Chờ thanh toán</span>
                      </ion-text>
                    </ion-badge>
                    <ion-badge  mode="ios" *ngSwitchCase="2" color="success">
                      <ion-text style="font-size: 1rem;color: white !important;" class="dynamic-font">
                        <span>Đã thanh toán</span>
                      </ion-text>
                    </ion-badge>
                    <ion-badge  mode="ios" *ngSwitchCase="3" color="danger">
                      <ion-text style="font-size: 1rem;color: white !important;" class="dynamic-font">
                        <span>Đã hủy</span>
                      </ion-text>
                    </ion-badge>
                    <ion-badge  mode="ios" *ngSwitchCase="4" color="medium">
                      <ion-text style="font-size: 1rem;color: white !important;" class="dynamic-font">
                        <span>Khác</span>
                      </ion-text>
                    </ion-badge>
                  </ng-container>
                </div>
                <div class="d-flex justify-content-end">
                  <ion-text class="dynamic-font font-weight-bold text-dark">
                    Tổng tiền:
                  </ion-text>
                  &nbsp;
                  <ion-text class="dynamic-font">
                    {{(item.totalPrice | number)+'đ'}}
                  </ion-text>
                </div>
              </div>
              <div *ngIf="item.status == 1" class="d-flex align-items-center justify-content-center text-center pt-3">
                <ion-button (click)="openPayment(item)" mode="ios" size="default" class="ion-btn-default">
                  <ion-icon style="color: white !important;" slot="start" name="wallet-outline"></ion-icon>
                  <ion-text style="color: white !important;" class="dynamic-font">
                    Thanh toán
                  </ion-text>
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-item>
      </ng-container>
    </ion-list>
  </div>
  <!-- payment -->
  <ion-modal id="modal-dialog" style="--background:white !important" (willDismiss)="cancelPayment()" [isOpen]="isOpenPayment">
    <ng-template>
      <div class="p-3 w-100 h-100">
        <div class="w-100 mb-3">
          <ion-text class="dynamic-font text-center text-dark">
            <h3 class="mx-0 my-0 font-weight-bold">Thanh toán đơn hàng</h3>
          </ion-text>
        </div>
        <div class="w-100 text-center">
          <ion-text class="dynamic-font text-dark">
            <span>Bạn có muốn thanh toán cho đơn hàng </span>
          </ion-text>
          <ion-text style="color: var(--ion-color-mat-primary) !important;" class="dynamic-font">
            <span>{{itemSelected?.shippingOrderCode}}</span>
          </ion-text>
          <ion-text class="dynamic-font text-dark">
            <span>? </span>
          </ion-text>
          <ion-text class="dynamic-font text-dark">
            <span>Tổng thanh toán cho đơn hàng là </span>
          </ion-text>
          <ion-text style="color: var(--ion-color-mat-primary) !important;" class="dynamic-font">
            <span>{{(itemSelected.totalPrice | number)+'đ'}}</span>
          </ion-text>
        </div>
        <div class="d-flex align-items-center justify-content-center mt-3">
          <ion-button (click)="onPayment(itemSelected)" mode="ios" size="default" class="ion-btn-default pr-3">
            <ion-text style="color: white !important;" class="dynamic-font">
              Đồng ý
            </ion-text>
          </ion-button>
          <ion-button (click)="cancelPayment()" mode="ios" size="default" color="medium">
            <ion-text style="color: white !important;" class="dynamic-font">
              Hủy bỏ
            </ion-text>
          </ion-button>
        </div>
      </div>
    </ng-template>
  </ion-modal>
  <!-- payment -->

  <!-- Filter -->
  <ion-modal style="--background:white !important" (willDismiss)="cancelFilter()" [isOpen]="isOpenFilter" [initialBreakpoint]="1" [breakpoints]="[0, 1]">
    <ng-template>
      <div class="p-3 w-100 h-100">
        <ion-text class="dynamic-font text-center" style="color: var(--ion-color-mat-primary);">
          <h3 class="font-weight-bold">Bộ lọc</h3>
        </ion-text>
        <div [formGroup]="formGroup">
          <ion-text>
            <h4 class="mt-0 font-weight-bold dynamic-font text-dark">Từ ngày</h4>
          </ion-text>
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Chọn từ ngày</mat-label>
            <input formControlName="fromDate" matInput [matDatepicker]="picker" readonly>
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
          <ion-text>
            <h4 class="mt-0 font-weight-bold dynamic-font text-dark">Đến ngày</h4>
          </ion-text>
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Chọn đến ngày</mat-label>
            <input formControlName="toDate" matInput [matDatepicker]="picker2" readonly>
            <mat-datepicker-toggle matIconSuffix [for]="picker2"></mat-datepicker-toggle>
            <mat-datepicker #picker2></mat-datepicker>
          </mat-form-field>
        </div>
        <div style="margin-bottom: var(--ion-safe-area-bottom, 0);" class="d-flex align-items-center justify-content-center mt-3">
          <ion-button class="w-100" (click)="clearFilter()" mode="ios" size="default" color="medium">
            <ion-text style="color: white !important;" class="dynamic-font">
              Xóa bộ lọc
            </ion-text>
          </ion-button> 
          <ion-button (click)="onFilter()" mode="ios" size="default" class="ion-btn-default w-100">
            <ion-text style="color: white !important;" class="dynamic-font">
              Áp dụng
            </ion-text>
          </ion-button> 
        </div>
      </div>
    </ng-template>
  </ion-modal>
  <!-- Filter -->
</ion-content>